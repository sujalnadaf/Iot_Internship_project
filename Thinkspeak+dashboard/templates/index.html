<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Environment Dashboard</title>

    <!-- ‚ùå REMOVE AUTO REFRESH -->
    <!-- <meta http-equiv="refresh" content="5"> -->

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<!-- ===== Header ===== -->
<header>
    <div class="title">
        üåç Smart Environment Monitoring System
        <span>Live IoT Sensor Dashboard</span>
    </div>
</header>

<!-- ===== Live Cards ===== -->
<section class="cards">

    <div class="card temp">
        <h3>Temperature</h3>
        <p id="temp">--<span>¬∞C</span></p>
        <div class="wave"></div>
    </div>

    <div class="card hum">
        <h3>Humidity</h3>
        <p id="hum">--<span>%</span></p>
        <div class="wave"></div>
    </div>

    <div class="card gas">
        <h3>Gas Level</h3>
        <p id="gas">--<span>ppm</span></p>
        <div class="wave"></div>
    </div>

</section>

<!-- ===== Table Section ===== -->
<section class="table-section">
    <h2>üìä Sensor Data History</h2>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Temperature (¬∞C)</th>
                    <th>Humidity (%)</th>
                    <th>Gas (ppm)</th>
                    <th>Timestamp</th>
                </tr>
            </thead>

            <tbody id="table-body">
                <!-- Filled by JS -->
            </tbody>
        </table>
    </div>
</section>

<footer>
    ¬© 2025 Smart Environment Monitoring | ESP32 + MQTT + MySQL + Flask
</footer>

<!-- ===== LIVE UPDATE SCRIPT ===== -->
<script>
function updateDashboard() {
    fetch("/latest")
    .then(response => response.json())
    .then(data => {
        if (data.length === 0) return;

        // Update cards
        document.getElementById("temp").innerHTML =
            data[0].temperature + "<span>¬∞C</span>";
        document.getElementById("hum").innerHTML =
            data[0].humidity + "<span>%</span>";
        document.getElementById("gas").innerHTML =
            data[0].gas + "<span>ppm</span>";

        // Update table
        let rows = "";
        data.forEach(row => {
            rows += `
                <tr>
                    <td>${row.id}</td>
                    <td>${row.temperature}</td>
                    <td>${row.humidity}</td>
                    <td>${row.gas}</td>
                    <td>${row.created_at}</td>
                </tr>
            `;
        });

        document.getElementById("table-body").innerHTML = rows;
    });
}

// Load immediately
updateDashboard();

// Refresh every 2 seconds
setInterval(updateDashboard, 2000);
</script>

</body>
</html>
